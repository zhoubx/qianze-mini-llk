# é¡¹ç›®ä»£ç å®¡æŸ¥æŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°
- **é¡¹ç›®ç±»å‹**: å¾®ä¿¡å°ç¨‹åº
- **é¡¹ç›®åç§°**: èŠŠæ³½å…»ç”Ÿ-ç©ä¹æƒ 
- **ä¸»è¦åŠŸèƒ½**: è¿è¿çœ‹æ¸¸æˆ + æ’è¡Œæ¦œ + å¥–å“ç³»ç»Ÿ
- **åç«¯æœåŠ¡**: Bmob (BaaS)

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (Critical Issues)

### 1. **è¯­æ³•é”™è¯¯** (Syntax Errors)
**ä½ç½®**: `pages/index/index.js`
- **ç¬¬163è¡Œ**: `query.order("-score");1` - æœ«å°¾æœ‰å¤šä½™çš„ `1`
- **ç¬¬166è¡Œ**: `query.find().then(res => {er` - æœ«å°¾æœ‰å¤šä½™çš„ `er`

**å½±å“**: ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œå¤±è´¥

### 2. **å®‰å…¨æ¼æ´** (Security Issues)
**ä½ç½®**: `app.js` ç¬¬5è¡Œ, `pages/index/index.js` ç¬¬9è¡Œ
- **é—®é¢˜**: Bmob APIå¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
  ```javascript
  Bmob.initialize("4fa0f30d648a4b33", "123zbx");
  ```
- **é£é™©**: 
  - å¯†é’¥æš´éœ²åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­
  - å¯èƒ½è¢«æ¶æ„ç”¨æˆ·è·å–å¹¶æ»¥ç”¨
- **å»ºè®®**: 
  - ä½¿ç”¨äº‘å‡½æ•°è·å–å¯†é’¥
  - æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆä½†å°ç¨‹åºç¯å¢ƒå˜é‡æ”¯æŒæœ‰é™ï¼‰
  - è‡³å°‘åº”è¯¥ä»æœåŠ¡å™¨ç«¯è·å–

### 3. **é€»è¾‘é”™è¯¯** (Logic Bug)
**ä½ç½®**: `pages/index/index.js` ç¬¬189-194è¡Œ
```javascript
let uniqueList = Object.values(userMap);
uniqueList.sort((a, b) => b.score - a.score);
let finalRankList = res;  // âŒ åº”è¯¥ä½¿ç”¨ uniqueList è€Œä¸æ˜¯ res

this.setData({
  rankList: finalRankList  // è¿™é‡Œä½¿ç”¨çš„æ˜¯æœªå»é‡çš„åŸå§‹æ•°æ®
});
```
- **é—®é¢˜**: ä»£ç åˆ›å»ºäº†å»é‡åçš„ `uniqueList`ï¼Œä½†æœ€ç»ˆä½¿ç”¨çš„æ˜¯æœªå»é‡çš„ `res`
- **å½±å“**: æ’è¡Œæ¦œä¼šæ˜¾ç¤ºé‡å¤ç”¨æˆ·ï¼Œå»é‡é€»è¾‘å¤±æ•ˆ

---

## âš ï¸ ä¸­ç­‰é—®é¢˜ (Medium Issues)

### 4. **é‡å¤åˆå§‹åŒ–**
**ä½ç½®**: `app.js` å’Œ `pages/index/index.js`
- **é—®é¢˜**: Bmob è¢«åˆå§‹åŒ–äº†ä¸¤æ¬¡
- **å½±å“**: ä¸å¿…è¦çš„é‡å¤æ“ä½œï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´
- **å»ºè®®**: åªåœ¨ `app.js` ä¸­åˆå§‹åŒ–ä¸€æ¬¡

### 5. **æœªä½¿ç”¨çš„ç»„ä»¶**
**ä½ç½®**: `pages/index/index.json` å’Œ `pages/index/index.wxml`
- **é—®é¢˜**: `navigation-bar` ç»„ä»¶è¢«å¼•å…¥ä½†æœªåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
- **å½±å“**: å¢åŠ ä¸å¿…è¦çš„åŒ…ä½“ç§¯
- **å»ºè®®**: å¦‚æœä¸éœ€è¦ï¼Œç§»é™¤å¼•ç”¨

### 6. **é”™è¯¯å¤„ç†ä¸è¶³**
**ä½ç½®**: å¤šå¤„
- **é—®é¢˜**: 
  - `fetchLeaderboard()` æ²¡æœ‰ `.catch()` å¤„ç†é”™è¯¯
  - `submitScore()` ä¸­éƒ¨åˆ†å¼‚æ­¥æ“ä½œç¼ºå°‘é”™è¯¯å¤„ç†
  - ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶ç”¨æˆ·ä½“éªŒä¸ä½³
- **å»ºè®®**: æ·»åŠ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### 7. **å†…å­˜æ³„æ¼é£é™©**
**ä½ç½®**: `pages/index/index.js`
- **é—®é¢˜**: 
  - `timer` åœ¨ `backToMenu()` ä¸­æ¸…é™¤ï¼Œä½†å¦‚æœç”¨æˆ·ç›´æ¥å…³é—­é¡µé¢å¯èƒ½æœªæ¸…é™¤
  - éŸ³é¢‘ä¸Šä¸‹æ–‡ `bgmCtx` å’Œ `matchCtx` æœªåœ¨é¡µé¢å¸è½½æ—¶é”€æ¯
- **å»ºè®®**: åœ¨ `onUnload()` ç”Ÿå‘½å‘¨æœŸä¸­æ¸…ç†èµ„æº

### 8. **ä»£ç é‡å¤**
**ä½ç½®**: æ—¥æœŸæ ¼å¼åŒ–é€»è¾‘
- **é—®é¢˜**: æ—¥æœŸæ ¼å¼åŒ–ä»£ç åœ¨ `index.js` å’Œ `prizes.js` ä¸­é‡å¤
- **å»ºè®®**: æå–ä¸ºå·¥å…·å‡½æ•°

---

## ğŸ’¡ æ”¹è¿›å»ºè®® (Improvements)

### 9. **ä»£ç è´¨é‡**
- **æ³¨é‡Š**: ä»£ç ä¸­æœ‰å¾ˆå¤šä¸­æ–‡æ³¨é‡Šï¼Œä½†éƒ¨åˆ†å…³é”®é€»è¾‘ç¼ºå°‘æ³¨é‡Š
- **å˜é‡å‘½å**: éƒ¨åˆ†å˜é‡åå¯ä»¥æ›´æ¸…æ™°ï¼ˆå¦‚ `t1`, `t2` å¯ä»¥æ”¹ä¸º `tile1`, `tile2`ï¼‰
- **é­”æ³•æ•°å­—**: å­˜åœ¨ä¸€äº›ç¡¬ç¼–ç çš„æ•°å­—ï¼ˆå¦‚ `9999`, `999`ï¼‰ï¼Œå»ºè®®æå–ä¸ºå¸¸é‡

### 10. **æ€§èƒ½ä¼˜åŒ–**
- **å›¾ç‰‡åŠ è½½**: æ¸¸æˆå›¾ç‰‡ä½¿ç”¨å¤–éƒ¨URLï¼Œå»ºè®®è€ƒè™‘é¢„åŠ è½½æˆ–ä½¿ç”¨æœ¬åœ°èµ„æº
- **æ’è¡Œæ¦œ**: é™åˆ¶æŸ¥è¯¢æ•°é‡ä¸º500å¯èƒ½è¿‡å¤šï¼Œå»ºè®®åˆ†é¡µåŠ è½½
- **éŸ³é¢‘**: èƒŒæ™¯éŸ³ä¹å’ŒéŸ³æ•ˆå¯ä»¥è€ƒè™‘æŒ‰éœ€åŠ è½½

### 11. **ç”¨æˆ·ä½“éªŒ**
- **åŠ è½½çŠ¶æ€**: `fetchLeaderboard()` æ²¡æœ‰åŠ è½½æç¤º
- **ç©ºçŠ¶æ€**: æ’è¡Œæ¦œä¸ºç©ºæ—¶çš„æç¤ºå¯ä»¥æ›´å‹å¥½
- **ç½‘ç»œé”™è¯¯**: ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶åº”è¯¥æœ‰é‡è¯•æœºåˆ¶

### 12. **æ•°æ®ä¸€è‡´æ€§**
- **æ’åè®¡ç®—**: `gameWin()` ä¸­çš„æ’åè®¡ç®—åŸºäºå½“å‰ `rankList`ï¼Œä½†è¿™æ˜¯å¼‚æ­¥è·å–çš„ï¼Œå¯èƒ½å­˜åœ¨æ—¶åºé—®é¢˜
- **å¥–å“çŠ¶æ€**: å¥–å“PKé€»è¾‘è¾ƒå¤æ‚ï¼Œå»ºè®®æ·»åŠ æ›´å¤šæ—¥å¿—ä¾¿äºè°ƒè¯•

### 13. **é…ç½®ç®¡ç†**
- **å›¾ç‰‡URL**: å›¾ç‰‡åŸºç¡€URLç¡¬ç¼–ç ï¼Œå»ºè®®æå–ä¸ºé…ç½®
- **æ—¶é—´èŒƒå›´**: `RANK_DURATION_HOURS` å·²é…ç½®åŒ–ï¼Œä½†å…¶ä»–é…ç½®é¡¹ä¹Ÿå¯ä»¥æå–

---

## âœ… åšå¾—å¥½çš„åœ°æ–¹ (Good Practices)

1. **åŠŸèƒ½å®Œæ•´**: æ¸¸æˆé€»è¾‘ã€æ’è¡Œæ¦œã€å¥–å“ç³»ç»ŸåŠŸèƒ½å®Œæ•´
2. **UIè®¾è®¡**: ç•Œé¢è®¾è®¡è¾ƒä¸ºç¾è§‚ï¼Œæœ‰è‰¯å¥½çš„è§†è§‰åé¦ˆ
3. **éš¾åº¦åˆ†çº§**: ä¸‰ç§éš¾åº¦çº§åˆ«è®¾è®¡åˆç†
4. **æ­»å±€æ£€æµ‹**: å®ç°äº†è‡ªåŠ¨æ´—ç‰ŒåŠŸèƒ½ï¼Œé¿å…æ— è§£æƒ…å†µ
5. **iOSå…¼å®¹**: è€ƒè™‘äº†iOSæ—¥æœŸæ ¼å¼å…¼å®¹æ€§é—®é¢˜
6. **ç”¨æˆ·æ˜µç§°**: æ”¯æŒè·å–å¾®ä¿¡æ˜µç§°ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§

### ç«‹å³ä¿®å¤ (P0)
1. ä¿®å¤è¯­æ³•é”™è¯¯ï¼ˆç¬¬163ã€166è¡Œï¼‰
2. ä¿®å¤æ’è¡Œæ¦œå»é‡é€»è¾‘é”™è¯¯
3. ç§»é™¤ç¡¬ç¼–ç çš„APIå¯†é’¥ï¼ˆæˆ–è‡³å°‘æ·»åŠ è­¦å‘Šæ³¨é‡Šï¼‰

### å°½å¿«ä¿®å¤ (P1)
4. ç§»é™¤é‡å¤çš„Bmobåˆå§‹åŒ–
5. æ·»åŠ é”™è¯¯å¤„ç†
6. ä¿®å¤å†…å­˜æ³„æ¼é£é™©

### è®¡åˆ’ä¿®å¤ (P2)
7. æå–é‡å¤ä»£ç ä¸ºå·¥å…·å‡½æ•°
8. ä¼˜åŒ–æ€§èƒ½
9. æ”¹è¿›ç”¨æˆ·ä½“éªŒ

---

## ğŸ”§ å…·ä½“ä¿®å¤å»ºè®®

### ä¿®å¤è¯­æ³•é”™è¯¯
```javascript
// ç¬¬163è¡Œ
query.order("-score");  // ç§»é™¤æœ«å°¾çš„ 1

// ç¬¬166è¡Œ  
query.find().then(res => {  // ç§»é™¤æœ«å°¾çš„ er
```

### ä¿®å¤æ’è¡Œæ¦œå»é‡é€»è¾‘
```javascript
let uniqueList = Object.values(userMap);
uniqueList.sort((a, b) => b.score - a.score);
let finalRankList = uniqueList;  // ä½¿ç”¨å»é‡åçš„åˆ—è¡¨

this.setData({
  rankList: finalRankList
});
```

### æå–æ—¥æœŸæ ¼å¼åŒ–å·¥å…·å‡½æ•°
å»ºè®®åˆ›å»º `utils/dateFormat.js`:
```javascript
export function formatDate(dateStr) {
  let timeStr = dateStr.replace(/-/g, '/');
  let d = new Date(timeStr);
  let m = (d.getMonth() + 1).toString().padStart(2, '0');
  let day = d.getDate().toString().padStart(2, '0');
  let h = d.getHours().toString().padStart(2, '0');
  let min = d.getMinutes().toString().padStart(2, '0');
  return `${m}-${day} ${h}:${min}`;
}
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **æ€»æ–‡ä»¶æ•°**: çº¦20ä¸ªæ–‡ä»¶
- **ä¸»è¦é¡µé¢**: 3ä¸ªï¼ˆindex, prizes, rulesï¼‰
- **ç»„ä»¶**: 1ä¸ªï¼ˆnavigation-barï¼Œæœªä½¿ç”¨ï¼‰
- **ä»£ç è¡Œæ•°**: çº¦1000+è¡Œ
- **ä¸»è¦ä¾èµ–**: Bmob SDK

---

## ğŸ¯ æ€»ç»“

é¡¹ç›®æ•´ä½“åŠŸèƒ½å®Œæ•´ï¼ŒUIè®¾è®¡è‰¯å¥½ï¼Œä½†å­˜åœ¨ä¸€äº›éœ€è¦ç«‹å³ä¿®å¤çš„ä¸¥é‡é—®é¢˜ï¼š
1. è¯­æ³•é”™è¯¯ä¼šå¯¼è‡´è¿è¡Œå¤±è´¥
2. å®‰å…¨æ¼æ´éœ€è¦å°½å¿«å¤„ç†
3. é€»è¾‘é”™è¯¯å½±å“æ’è¡Œæ¦œåŠŸèƒ½

å»ºè®®ä¼˜å…ˆä¿®å¤P0çº§åˆ«çš„é—®é¢˜ï¼Œç„¶åé€æ­¥ä¼˜åŒ–ä»£ç è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚

