<view class="container">
  <!-- 音乐控制组件 -->
  <music-control id="musicControl"></music-control>

  <text class="title">游戏与奖品规则</text>
  <view class="section">
    <text class="h2">1. 积分与排名</text>
    <text class="p">• 榜单采取 <text class="highlight">72小时滚动制</text>，只会保留最近72小时的挑战成绩，让每位顾客都有机会霸榜。</text>
    <text class="p">• 积分计算公式：<text class="highlight">基础分数 + 洗牌加分</text></text>
    
    <!-- 展开/收起按钮 -->
    <view class="toggle-link" bindtap="toggleScoreDetail">
      <text class="toggle-link-text">{{showScoreDetail ? '收起计分详情' : '查看计分详情'}}</text>
      <text class="toggle-link-icon">{{showScoreDetail ? '▲' : '▼'}}</text>
    </view>
    
    <!-- 可折叠的详细规则区域 -->
    <view class="collapsible {{showScoreDetail ? 'expanded' : ''}}">
      <text class="sub-title">基础分数计算：</text>
      <text class="p indent">基础分数 = (消除对数 × 1000 ÷ 耗时) × 难度系数</text>
      <view class="difficulty-box">
        <text class="difficulty-item" wx:for="{{difficultyOptions}}" wx:key="id">• {{item.badge}}模式：难度系数 = {{item.multiplier}}</text>
      </view>
      <text class="sub-title">洗牌加分说明：</text>
      <text class="p indent">当游戏出现死局（无可消除方块）时，系统会自动洗牌，不同难度加分不同：</text>
      <view class="difficulty-box">
        <text class="difficulty-item" wx:for="{{difficultyOptions}}" wx:key="id">• {{item.badge}}模式：每次洗牌 <text class="highlight">{{shuffleBonus[item.id] === 0 ? '不加分' : '+' + shuffleBonus[item.id] + '分'}}</text></text>
      </view>
      <text class="sub-title">计分举例：</text>
      <view class="example-box">
        <text class="example-title">示例 1：简单模式，遇到1次死局</text>
        <text class="example-text">• 消除对数：{{pairs.easy}} 对</text>
        <text class="example-text">• 耗时：{{exampleTime.easy}} 秒（按每对1.5秒计算）</text>
        <text class="example-text">• 难度系数：{{multiplier.easy}}（简单模式）</text>
        <text class="example-text">• 洗牌次数：1 次（简单模式不加分）</text>
        <text class="example-result">基础分 = ({{pairs.easy}} × 1000 ÷ {{exampleTime.easy}}) × {{multiplier.easy}} = {{baseScore.easy}} 分</text>
        <text class="example-result">洗牌加分 = {{shuffleBonus.easy}} × 1 = {{shuffleBonus.easy}} 分</text>
        <text class="example-result">最终得分 = {{baseScore.easy}} + {{shuffleBonus.easy}} = <text class="score-highlight">{{baseScore.easy + shuffleBonus.easy}} 分</text></text>
      </view>
      <view class="example-box">
        <text class="example-title">示例 2：普通模式，遇到2次死局</text>
        <text class="example-text">• 消除对数：{{pairs.medium}} 对</text>
        <text class="example-text">• 耗时：{{exampleTime.medium}} 秒（按每对1.5秒计算）</text>
        <text class="example-text">• 难度系数：{{multiplier.medium}}（普通模式）</text>
        <text class="example-text">• 洗牌次数：2 次</text>
        <text class="example-result">基础分 = ({{pairs.medium}} × 1000 ÷ {{exampleTime.medium}}) × {{multiplier.medium}} = {{baseScore.medium}} 分</text>
        <text class="example-result">洗牌加分 = {{shuffleBonus.medium}} × 2 = {{shuffleBonus.medium * 2}} 分</text>
        <text class="example-result">最终得分 = {{baseScore.medium}} + {{shuffleBonus.medium * 2}} = <text class="score-highlight">{{baseScore.medium + shuffleBonus.medium * 2}} 分</text></text>
      </view>
      <view class="example-box">
        <text class="example-title">示例 3：困难模式，遇到3次死局</text>
        <text class="example-text">• 消除对数：{{pairs.hard}} 对</text>
        <text class="example-text">• 耗时：{{exampleTime.hard}} 秒（按每对1.5秒计算）</text>
        <text class="example-text">• 难度系数：{{multiplier.hard}}（困难模式）</text>
        <text class="example-text">• 洗牌次数：3 次</text>
        <text class="example-result">基础分 = ({{pairs.hard}} × 1000 ÷ {{exampleTime.hard}}) × {{multiplier.hard}} = {{baseScore.hard}} 分</text>
        <text class="example-result">洗牌加分 = {{shuffleBonus.hard}} × 3 = {{shuffleBonus.hard * 3}} 分</text>
        <text class="example-result">最终得分 = {{baseScore.hard}} + {{shuffleBonus.hard * 3}} = <text class="score-highlight">{{baseScore.hard + shuffleBonus.hard * 3}} 分</text></text>
      </view>
      <text class="p tip">💡 温馨提示：难度越高，积分系数越大，洗牌加分也越多！困难模式每次洗牌可获得{{shuffleBonus.hard}}分奖励！更有机会赢得高分排名哦！</text>
      
      <!-- 底部收起按钮 -->
      <view class="collapse-link" bindtap="toggleScoreDetail">
        <text class="collapse-link-icon">▲</text>
        <text class="collapse-link-text">收起详情</text>
      </view>
    </view>
  </view>
  <view class="section">
    <text class="h2">2. 奖品兑换</text>
    <text class="p">• 所有获得的优惠券/精油时长仅限 <text class="highlight">下次到店消费时使用</text>。</text>
    <text class="p">• 凭"我的奖品"页面中的记录向店员核销。</text>
    <text class="p">• 顾客到店消费时，每个项目最多可以使用 <text class="highlight">1 张游戏优惠券 + 1 张分享优惠券</text>，不能同时使用两张游戏优惠券或两张分享优惠券，即：同类型的券不能叠加使用。</text>
  </view>
  <view class="section">
    <text class="h2">3. 最好成绩原则</text>
    <text class="p">• 每位玩家同时只能拥有 <text class="highlight">一张</text> "待使用"的最高级奖品。</text>
    <text class="p">• 如果您刷新了自己的记录并赢得了更好的奖品，旧奖品将自动失效。</text>
    <text class="p">• 核销使用后，您可以再次挑战赢取新奖品。</text>
  </view>

  <view class="section">
    <text class="h2">4. 分享得优惠券</text>
    <text class="p">• 将小程序分享给好友，好友<text class="highlight">首次完成游戏</text>后，您将获得 <text class="highlight">{{shareCouponAmount}}元代金券</text> 奖励！</text>
    <text class="p">• 通过分享得到的优惠券可以与游戏中得到的优惠券<text class="highlight">叠加使用</text>！</text>
    <text class="p">• 每位用户最多可获得 <text class="highlight">{{shareCouponMaxCount}} 张</text>分享代金券。</text>
    <text class="p">• 分享代金券可在"我的奖品"页面中查看和使用。</text>
    <text class="p tip">💡 小贴士：邀请好友一起来挑战，边玩游戏边赚优惠券！</text>
  </view>

</view>