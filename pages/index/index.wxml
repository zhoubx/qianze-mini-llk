<view class="container">
  <view class="header">
    <text class="title">èŠŠæ³½å…»ç”Ÿ SPA</text>
    <text class="slogan">å‡­å®åŠ›èµ¢ä¼˜æƒ åˆ¸ï¼Œèº«å¿ƒæ„‰æ‚¦ä¸¤ä¸è¯¯ï¼</text>
  </view>

  <!-- éŸ³ä¹æ§åˆ¶ç»„ä»¶ -->
  <music-control id="musicControl"></music-control>

  <view class="top-actions" wx:if="{{!isGameActive}}">
    <navigator url="/pages/rules/rules" class="action-link">ğŸ“– æ¸¸æˆè§„åˆ™</navigator>
    <navigator url="/pages/prizes/prizes" class="action-link">ğŸ æˆ‘çš„å¥–å“</navigator>
  </view>

  <view class="menu-screen" wx:if="{{!isGameActive}}">
    <view class="difficulty-card {{item.class}}" wx:for="{{diffConfig}}" wx:key="id" bindtap="startGame" data-diff="{{item.id}}">
      <view class="diff-info">
        <view class="diff-header">
          <text class="diff-title">{{item.title}}</text>
          <text class="diff-badge {{item.badgeClass}}">{{item.badge}}</text>
          <text class="diff-multiplier {{item.badgeClass}}">x{{item.multiplier}}</text>
        </view>
        <text class="diff-desc">{{item.desc}}</text>
      </view>
      <view style="font-size:48rpx">{{item.icon}}</view>
    </view>

    <view class="leaderboard-box">
      <view class="lb-header">
        <text class="lb-title">ğŸ‘‘ å…¨æœé£äº‘æ¦œï¼ˆ72å°æ—¶ï¼‰</text>
        <view class="lb-refresh-wrapper">
          <text class="lb-timer" bindtap="fetchLeaderboard">ğŸ”„ åˆ·æ–°</text>
          <text class="lb-loading-icon {{isRefreshing ? 'rotating' : ''}}" wx:if="{{isRefreshing}}">â³</text>
        </view>
      </view>
      <scroll-view scroll-y class="lb-list">
        <view wx:if="{{rankList.length === 0}}" style="text-align:center;color:#999;margin-top:50rpx;font-size:24rpx">æš‚æ— æ•°æ®ï¼Œå¿«æ¥æŠ¢å æ¦œé¦–ï¼</view>
        <view class="lb-item" wx:for="{{rankList}}" wx:key="objectId">
          <text class="lb-rank rank-{{index+1}}">{{index + 1}}</text>
          <view class="lb-info">
            <view class="lb-name-row">
              <text class="lb-name">{{item.playerName}}</text>
              <view class="lb-prize-tag">ğŸ {{item.prizeName}}</view>
            </view>
            <text class="lb-time-row">{{item.createTimeStr}} Â· è€—æ—¶{{item.timeCost}}s</text>
          </view>
          <text class="lb-score">{{item.score}}</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <view class="game-screen" wx:if="{{isGameActive}}">
    <view class="status-bar">
      <text>â±ï¸ {{timeDisplay}}s</text>
      <text>â­ {{liveScore}}</text>
    </view>
    
    <view class="game-board" style="grid-template-columns: repeat({{cols}}, 1fr);">
      <view wx:for="{{domTiles}}" wx:key="id" 
            class="tile {{item.selected ? 'selected' : ''}} {{item.matched ? 'matched' : ''}} {{item.isPath ? 'path-highlight' : ''}}"
            style="background-image: url('{{item.img}}'); width:{{tileSize}}; height:{{tileSize}};"
            bindtap="handleTileClick" data-r="{{item.r}}" data-c="{{item.c}}">
      </view>
    </view>
    
    <button style="background:transparent; color:#888; font-size:28rpx; margin-top:20rpx;" bindtap="backToMenu">æ”¾å¼ƒæŒ‘æˆ˜</button>
  </view>

  <view class="modal-overlay" wx:if="{{showModal}}">
    <view class="modal">
      <view class="win-header">æŒ‘æˆ˜æˆåŠŸ!</view>
      <view class="prize-alert">
        <view class="prize-rank">é¢„è®¡æ’å: ç¬¬ <text style="font-weight:bold;">{{myRank}}</text> å</view>
        <view class="prize-name">{{finalPrizeName}}</view>
      </view>
      
      <view class="input-group">
        <text class="input-label">è¯·å½•å…¥æ‚¨çš„ç©å®¶å(ç”¨äºé¢†å¥–æ ¸é”€)ï¼š</text>
        
        <button 
          bindtap="getUserProfile" 
          size="mini" 
          type="default" 
          style="font-size: 24rpx; margin-bottom: 10rpx; width: 100%;">
          ğŸ‘‡ ç‚¹æˆ‘ä¸€é”®è·å–å¾®ä¿¡æ˜µç§°
        </button>

        <input class="name-input" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°/æ‰‹æœºå·" value="{{inputName}}" bindinput="onNameInput" maxlength="12"/>
      </view>
   
      <button class="btn-primary" loading="{{submitting}}" bindtap="submitScore">ç¡®è®¤é¢†å–å¹¶ä¸Šæ¦œ</button>
      <button style="font-size:24rpx; color:#666; background:transparent;" open-type="share">ğŸ‰ ç‚«è€€æˆ˜ç»©</button>
    </view>
  </view>
  
</view>