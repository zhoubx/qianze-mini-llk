<view class="container">
  <!-- 音乐控制组件 -->
  <music-control id="musicControl"></music-control>

  <!-- 页面标题栏 -->
  <view class="page-header">
    <view class="header-main">
      <text class="header-icon">🎁</text>
      <text class="header-title">我的奖品</text>
    </view>
    <view class="header-tips">
      <view class="tip-item">
        <text class="tip-dot">•</text>
        <text class="tip-text">系统只保留您游戏中领取到的最高奖项，核销后可再次领取</text>
      </view>
      <view class="tip-item tip-highlight">
        <text class="tip-dot">•</text>
        <text class="tip-text">邀请好友一起玩游戏，还可额外获得奖励！</text>
      </view>
    </view>
  </view>

  <!-- 个人信息模块 -->
  <view class="profile-section">
    <!-- 展示模式 -->
    <view class="profile-display" wx:if="{{!isEditingProfile}}">
      <image class="profile-avatar" src="{{userInfo.avatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
      <view class="profile-details">
        <text class="profile-name">{{userInfo.nickName || '未设置昵称'}}</text>
        <text class="profile-hint">修改将同步到排行榜</text>
      </view>
      <button class="profile-edit-btn" bindtap="startEditProfile">修改</button>
    </view>

    <!-- 编辑模式 -->
    <view class="profile-edit" wx:if="{{isEditingProfile}}">
      <view class="edit-row">
        <button class="avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
          <image class="avatar-preview" src="{{editingAvatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
          <text class="avatar-tip">点击换头像</text>
        </button>
        <input 
          type="nickname" 
          class="field-input" 
          placeholder="请输入昵称" 
          value="{{editingNickName}}"
          bindinput="onNickNameInput"
          maxlength="20"
        />
      </view>
      <view class="edit-actions">
        <button class="btn-cancel" bindtap="cancelEditProfile">取消</button>
        <button class="btn-save" bindtap="saveUserInfo">保存</button>
      </view>
    </view>
  </view>

  <!-- 奖品列表 -->
  <view class="list">
    <view wx:if="{{prizes.length===0 && !loading}}" class="empty">暂无奖品记录，快去玩游戏赢取吧！</view>
    
    <view class="card {{item.status}}" wx:for="{{prizes}}" wx:key="objectId">
      <view class="card-left">
        <view class="row-top">
          <text class="prize-name">{{item.prizeName}}</text>
        </view>
        
        <view class="row-detail">
          <text class="tag">{{item.diffText}}</text>
          <text class="divider">|</text>
          <text class="tag">{{item.timeCost}}s</text>
          <text class="divider">|</text>
          <text class="tag">{{item.rankText}}</text>
          <text class="divider">|</text>
          <text class="score">{{item.score}}分</text>
        </view>

        <view class="row-time">
          <text>过关时间：{{item.createTimeStr}}</text>
        </view>
      </view>

      <view class="card-right">
        <block wx:if="{{item.status === 'pending'}}" >
           <button class="use-btn" bindtap="usePrize" data-id="{{item.objectId}}">核销</button>
        </block>
        <block wx:else>
           <view class="status-info">
             <text class="status-text">{{item.statusText}}</text>
             <view wx:if="{{item.status === 'used'}}" class="redemption-time">
               {{item.redeemedTime ? item.redeemedTimeStr : '暂无时间记录'}}
             </view>
           </view>
        </block>
      </view>
    </view>
  </view>
</view>
